#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <string.h>

#define MAX_NOME 20
#define MAX_FAMILIA 4

typedef struct {
    char nome[MAX_NOME];
    int saude;
    int vivo;
} Membro;

typedef struct {
    Membro familia[MAX_FAMILIA];
    int combustivel;
    int carroQuebrado;
    int etapaAtual;
} Jogo;

const char* etapas[] = {
    "Xique-Xique",
    "Barreiras",
    "Bras√≠lia",
    "Foz do Igua√ßu",
    "Argentina (chegamos, cabra!)"
};

void inicializarJogo(Jogo *jogo) {
    printf("=== TRILHA DA FAM√çLIA VALENTE ===\n\n");
    for(int i = 0; i < MAX_FAMILIA; i++) {
        printf("Digite o nome do membro %d da fam√≠lia: ", i+1);
        scanf("%s", jogo->familia[i].nome);
        jogo->familia[i].saude = 100;
        jogo->familia[i].vivo = 1;
    }
    jogo->combustivel = 100;
    jogo->carroQuebrado = 0;
    jogo->etapaAtual = 0;
    srand(time(NULL));
}

void status(Jogo *jogo) {
    printf("\n--- STATUS DA FAM√çLIA ---\n");
    printf("Local: %s\n", etapas[jogo->etapaAtual]);
    printf("Combust√≠vel: %d\n", jogo->combustivel);
    printf("Carro quebrado? %s\n", jogo->carroQuebrado ? "SIM" : "N√ÉO");
    for(int i = 0; i < MAX_FAMILIA; i++) {
        printf("%s - Sa√∫de: %d - %s\n", 
            jogo->familia[i].nome, 
            jogo->familia[i].saude,
            jogo->familia[i].vivo ? "VIVO" : "MORREU");
    }
    printf("------------------------\n");
}

void eventoAleatorio(Jogo *jogo) {
    int evento = rand() % 6;
    switch(evento) {
        case 0:
            printf("\nO calor do sert√£o t√° de matar! Todos perdem 10 de sa√∫de.\n");
            for(int i = 0; i < MAX_FAMILIA; i++)
                jogo->familia[i].saude -= 10;
            break;
        case 1:
            printf("\nUm jegue travou a estrada! Perde 15 de combust√≠vel.\n");
            jogo->combustivel -= 15;
            break;
        case 2:
            printf("\nPneu furado! Carro quebrou.\n");
            jogo->carroQuebrado = 1;
            break;
        case 3:
            printf("\nEncontraram uma vendinha com coxinha! +10 de sa√∫de pra todos.\n");
            for(int i = 0; i < MAX_FAMILIA; i++)
                jogo->familia[i].saude += 10;
            break;
        case 4:
            printf("\nChuva de granizo em Goi√°s! Um membro foi atingido.\n");
            int vitima = rand() % MAX_FAMILIA;
            jogo->familia[vitima].saude -= 40;
            break;
        case 5:
            printf("\nPosto BR achado! +20 de combust√≠vel.\n");
            jogo->combustivel += 20;
            break;
    }

    // Verifica mortes
    for(int i = 0; i < MAX_FAMILIA; i++) {
        if(jogo->familia[i].saude <= 0 && jogo->familia[i].vivo) {
            printf("\nXiii... %s n√£o aguentou e morreu no caminho.\n", jogo->familia[i].nome);
            jogo->familia[i].vivo = 0;
        }
    }
}

void consertarCarro(Jogo *jogo) {
    if(jogo->carroQuebrado) {
        printf("Seu tio Z√© deu um jeito no carro com arame e f√©. Carro consertado!\n");
        jogo->carroQuebrado = 0;
    }
}

void proximaEtapa(Jogo *jogo) {
    if(jogo->carroQuebrado) {
        printf("O carro t√° quebrado! Precisa consertar antes.\n");
        return;
    }

    if(jogo->combustivel < 20) {
        printf("Sem combust√≠vel suficiente pra seguir viagem!\n");
        return;
    }

    jogo->combustivel -= 20;
    jogo->etapaAtual++;
    printf("\n--- Indo para %s ---\n", etapas[jogo->etapaAtual]);
    eventoAleatorio(jogo);
}

int todosMortos(Jogo *jogo) {
    for(int i = 0; i < MAX_FAMILIA; i++)
        if(jogo->familia[i].vivo) return 0;
    return 1;
}

int main() {
    Jogo jogo;
    inicializarJogo(&jogo);

    while(jogo.etapaAtual < 4 && !todosMortos(&jogo)) {
        status(&jogo);
        printf("\nEscolha uma a√ß√£o:\n");
        printf("1 - Continuar viagem\n");
        printf("2 - Consertar o carro\n");
        printf("3 - Checar status\n");
        printf("Digite sua escolha: ");

        int escolha;
        scanf("%d", &escolha);

        switch(escolha) {
            case 1:
                proximaEtapa(&jogo);
                break;
            case 2:
                consertarCarro(&jogo);
                break;
            case 3:
                status(&jogo);
                break;
            default:
                printf("Op√ß√£o inv√°lida!\n");
        }
    }

    if(todosMortos(&jogo)) {
        printf("\nA fam√≠lia toda se foi no caminho... F triste.\n");
    } else if(jogo.etapaAtual == 4) {
        printf("\nüéâ VOC√äS CHEGARAM NA ARGENTINA! Parab√©ns, fam√≠lia valente! üéâ\n");
    }

    return 0;
}
